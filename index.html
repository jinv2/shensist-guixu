<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥æ€Â·å½’å¢Ÿ | å®ªæ³•å¼•æ“</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #050505;
            --text-main: #e0e0e0;
            --text-dim: #777;
            --accent-red: #cc0000;
            --border-color: #333;
            --panel-bg: rgba(20, 20, 20, 0.85);
            --bar-bg: #1a1a1a;
        }
        /* ==========================================
   ğŸ§  ã€Šå±±æµ·ç»ã€‹ç¥è¯ä»™å¢ƒèƒŒæ™¯æ¤å…¥
   Â©2026 ç¥æ€åº­ (Shensist) Â· å¤©ç®—AIæ„å»º
   ========================================== */

body {
    /* æ ¸å¿ƒä¿®æ”¹ï¼šè°ƒä½é»‘é›¾æµ“åº¦ï¼ä» 0.95 é™åˆ° 0.6~0.8ï¼Œè®©å¤§å¦–æ˜¾å‡ºçœŸèº«ï¼ */
    background-image: linear-gradient(rgba(5, 5, 5, 0.6), rgba(5, 5, 5, 0.8)), url('./shanhaijing.png');
    
    background-color: #050505;
    background-size: cover;
    background-position: center top;
    background-attachment: fixed;
    background-repeat: no-repeat;
    
    /* å¯åŠ¨å¹»é˜µèƒŒæ™¯å‘¼å¸è½®æ’­åŠ¨ç”» */
    animation: guixu-bg-slider 30s infinite alternate ease-in-out;
    
    color: var(--text-main);
    font-family: 'Courier New', Courier, monospace;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    height: 100vh; overflow: hidden;
    position: relative;
}

/* å½’å¢Ÿä¸‰å¦–å›¾å‘¼å¸äº¤æ›¿åŠ¨ç”»å…³é”®å¸§ */
@keyframes guixu-bg-slider {
    0%, 25% {
        background-image: linear-gradient(rgba(5, 5, 5, 0.6), rgba(5, 5, 5, 0.8)), url('./shanhaijing.png');
    }
    33%, 58% {
        background-image: linear-gradient(rgba(5, 5, 5, 0.6), rgba(5, 5, 5, 0.8)), url('./shanhaijing2.png');
    }
    66%, 91% {
        background-image: linear-gradient(rgba(5, 5, 5, 0.6), rgba(5, 5, 5, 0.8)), url('./shanhaijing3.png');
    }
    100% {
        background-image: linear-gradient(rgba(5, 5, 5, 0.6), rgba(5, 5, 5, 0.8)), url('./shanhaijing.png');
    }
}

/* å¢å¼ºï¼šä¸ºæ ‡é¢˜å’Œçœ‹æ¿å¢åŠ æ›´æ·±é‚ƒçš„æ™•å…‰ï¼Œä½¿å…¶æµ®ç°åœ¨ä»™å¢ƒä¹‹ä¸Š */
h1 {
    text-shadow: 
        0 0 15px #ff0000, 
        0 0 30px #8b0000, 
        0 0 50px #660000;
}

/* ç¡®ä¿æ‰€æœ‰æ ¸å¿ƒå¤§å—éƒ½æœ‰ç»Ÿä¸€çš„æœ€å¤§å®½åº¦å¹¶å±…ä¸­ */
header, 
#setup-screen, 
#battle-screen, 
#dashboard-container {
    width: 95%;
    max-width: 900px; /* é”å®šé»„é‡‘è§†è§‰å®½åº¦ */
    margin-left: auto;
    margin-right: auto;
}
        
        /* æåº¦ç²˜ç¨ ã€ç¼“æ…¢ä¸‹è½çš„é²œè¡€ */
        .blood-drop {
            position: absolute; top: -50px; width: 4px;
            background: linear-gradient(to bottom, transparent 0%, #300000 20%, #ff0000 100%);
            border-radius: 2px; opacity: 0; z-index: 10; pointer-events: none;
            filter: drop-shadow(0 0 5px rgba(255,0,0,0.5));
            /* ç²˜ç¨ åŠ¨ç”»ï¼šæŒ‚ä½ä¸æ”¾ -> æå…¶ææ…¢æ»‘è½ */
            animation: viscousDrip linear infinite;
        }
        @keyframes viscousDrip {
            0% { transform: translateY(0) scaleY(1); opacity: 0; }
            5% { opacity: 0.8; }
            /* æŒ‚åœ¨æ ‘æä¸Šå¾ˆä¹… */
            30% { transform: translateY(100px) scaleY(2); opacity: 1; } 
            /* æå…¶ç¼“æ…¢åœ°æ‹‰é•¿å’Œæ»‘è½ */
            90% { transform: translateY(85vh) scaleY(5); opacity: 0.8; }
            100% { transform: translateY(100vh) scaleY(1); opacity: 0; }
        }

        header, #setup-screen, #battle-screen { z-index: 20; width: 90%; max-width: 800px; position: relative;}

        header {
            text-align: left; margin-top: 20px; 
            /* å°†å·¦å³ padding è®¾ç½®ä¸º 0ï¼Œè®©å†…å®¹å®Œå…¨è´´åˆå·¦ä¾§è¾¹ç•Œ */
            padding: 15px 0; display: flex; align-items: center; gap: 20px; 
            position: relative; overflow: hidden;
            border-radius: 8px;
        }
        /* ã€å…³é”®ä¿®æ­£ã€‘ç¥ç§˜æ„Ÿå¢å¼ºï¼šæ›´å¤§èŒƒå›´çš„è™šåŒ– */
        header::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            /* æ ¸å¿ƒï¼šå°† radial-gradient çš„åœæ­¢ç‚¹æ¨å¾—æ›´è¿œï¼ˆ70% -> 90%ï¼‰ï¼Œå¢åŠ è™šåŒ–èŒƒå›´ */
            background: radial-gradient(ellipse at center, rgba(139,0,0,0.8) 0%, rgba(50,0,0,0.3) 60%, transparent 90%);
            filter: blur(20px); /* æ¨¡ç³Šåº¦åŠ å€ */
            z-index: -1;
            animation: pulseMysterious 5s infinite; /* æ·»åŠ ä¸€ä¸ªç¼“æ…¢çš„è„‰åŠ¨åŠ¨æ•ˆ */
            pointer-events: none; /* ã€ç»æ€ä¿®å¤ã€‘ï¼šè®©çº¢å…‰å½»åº•å¤±å»ç‰©ç†ç¢°æ’ä½“ç§¯ï¼Œé¼ æ ‡å¯ä»¥ç©¿é€å®ƒç‚¹å‡»ä¸‹æ–¹çš„æ‰€æœ‰æŒ‰é’®ï¼ */
        }

        @keyframes pulseMysterious {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }
        
        .main-logo-container { flex-shrink: 0; width: 80px; display: flex; justify-content: center; }
        /* ç¡®ä¿ LOGO è·¯å¾„ç¨³å›º */
        .main-logo { max-width: 100%; height: auto; filter: invert(1); opacity: 0.9; }
        
        /* æ ‡é¢˜æ™•å…‰å¢å¼º */
        h1 {
            font-size: 2.5rem;
            color: #fff;
            margin: 0;
            letter-spacing: 6px;
            text-shadow: 
                0 0 15px #ff0000, 
                0 0 30px #8b0000, 
                0 0 50px #660000;
        }

        /* å¢åŠ æ ‡é¢˜è„‰åŠ¨æ„Ÿ */
        @keyframes titlePulse {
            0%, 100% { text-shadow: 0 0 15px #ff0000, 0 0 30px #8b0000; }
            50% { text-shadow: 0 0 25px #ff4444, 0 0 50px #cc0000; }
        }
        /* å‰¯æ ‡é¢˜ï¼šå¢å¼ºå¯¹æ¯”åº¦ï¼Œç¡®ä¿æ¸…æ™°å¯è§ */
        .slogan {
            color: #ffcccc; /* æµ…æ·¡çš„è‚‰ç²‰çº¢ï¼Œç¡®ä¿åœ¨æš—çº¢èƒŒæ™¯ä¸‹å¯è§ */
            font-size: 1rem;
            letter-spacing: 4px;
            margin-top: 5px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
            font-weight: bold;
        }
        
        /* å½»åº•æº¶è§£è¾¹ç•Œï¼šå°†çœ‹æ¿å˜ä¸ºæ— å½¢çš„çº¢è•´èƒ½åœº */
        #dashboard-container {
            position: relative;
            width: 95%;
            max-width: 900px;
            margin: 10px auto; /* ç¼©çŸ­ä¸ä¸Šæ–¹çš„è·ç¦» */
            padding: 30px;
            background: radial-gradient(circle at center, rgba(139, 0, 0, 0.2) 0%, rgba(5, 5, 5, 0) 80%); 
            border: none !important; /* åšå†³å»æ‰è¾¹çº¿ */
            /* æè‡´è™šåŒ–ï¼šé€šè¿‡å·¨å¤§çš„é˜´å½±æ‰©æ•£å®ç°è¾¹çº¿æ¶ˆå¤± */
            box-shadow: 
                0 0 120px 60px rgba(139, 0, 0, 0.2), 
                inset 0 0 80px 30px rgba(139, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            font-family: 'Courier New', Courier, monospace;
        }
        
        #setup-screen { overflow-y: auto; max-height: calc(100vh - 140px); margin-top: 20px; margin-bottom: 20px; padding-right: 10px; }
        #setup-screen::-webkit-scrollbar { width: 4px; }
        #setup-screen::-webkit-scrollbar-thumb { background: var(--accent-red); }

        .form-group { margin-bottom: 25px; background: var(--panel-bg); padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        label { display: block; margin-bottom: 10px; color: var(--accent-red); font-weight: bold; }
        input[type="text"], input[type="password"], select, textarea {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.8); border: 1px solid var(--border-color);
            color: var(--text-main); font-family: inherit; box-sizing: border-box; font-size: 1rem;
        }
        
        /* äºŒçº§æŠ˜å é¢æ¿äº¤äº’ï¼šé€‚åˆå…¨è¡Œä¸šç»„åˆ */
        .scenario-panel { margin-top: 10px; border: 1px dashed #444; }
        
        .category-header {
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: #1a1a1a; border-bottom: 1px solid #333; transition: 0.2s;
        }
        .category-header:hover { background: #2a2a2a; border-color: var(--accent-red); }
        .category-header h3 { margin: 0; font-size: 1rem; color: #aaa; }
        .category-header span { color: #aaa; transition: transform 0.3s; }
        .category-header.active span { transform: rotate(180deg); color: var(--accent-red); }
        .category-header.active h3 { color: #fff; text-shadow: 0 0 5px var(--accent-red); }

        .tags-container { display: none; flex-wrap: wrap; gap: 8px; padding: 15px; background: rgba(0,0,0,0.5); }
        .tag-btn {
            background: rgba(0, 0, 0, 0.7); border: 1px solid #555; color: #aaa;
            padding: 8px 12px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; border-radius: 2px;
        }
        .tag-btn:hover { border-color: var(--accent-red); color: #fff; }
        .tag-btn.active { background: var(--accent-red); border-color: #fff; color: #fff; font-weight: bold; box-shadow: 0 0 10px var(--accent-red); }

        #sys-error-msg { background-color: #ff0000; color: #fff; font-weight: bold; padding: 15px; margin-bottom: 20px; text-align: center; border: 2px solid #fff; display: none; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-10px); } 40%, 80% { transform: translateX(10px); } }

        button.action-btn { background-color: transparent; color: var(--accent-red); border: 2px solid var(--accent-red); padding: 20px; width: 100%; font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: 0.3s;}
        button.action-btn:hover { background-color: var(--accent-red); color: #fff; box-shadow: 0 0 20px var(--accent-red); }

        /* èµ›åšé£æˆ˜æ–—ç•Œé¢ */
        /* ç§»é™¤å›ºå®šçš„ heightï¼Œæ”¹ä¸º flex æ’‘å¼€ï¼Œå¹¶ç•™å‡ºåº•éƒ¨ç‰ˆæƒç©ºé—´ */
        #battle-screen { display: none; flex-direction: column; width: 100%; margin-top: 20px; padding-bottom: 80px; position: relative; }
        /* é¡¶éƒ¨åŠŸèƒ½æŒ‰é’®ç»„ï¼ˆå¯¼å‡ºä¸é‡ç½®ï¼‰ */
        .utility-btn {
            background: rgba(139,0,0,0.1);
            border: 1px dashed var(--accent-red);
            color: #ccc;
            padding: 4px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.3s;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .utility-btn:hover {
            background: var(--accent-red);
            color: #fff;
            border-color: #fff;
            box-shadow: 0 0 10px rgba(139,0,0,0.8);
        }

        /* ä¿®å¤ Markdown æ¸²æŸ“åçš„æ®µè½é—´è· */
        .typing-content p { margin-top: 0; margin-bottom: 10px; }
        .typing-content ul { margin-top: 0; padding-left: 20px; }
        #chat-log { flex-grow: 1; height: 50vh; min-height: 400px; background: rgba(0,0,0,0.8); border: 1px solid var(--border-color); padding: 20px; overflow-y: auto; margin-bottom: 10px; }
        #chat-log::-webkit-scrollbar { width: 8px; background: #000; }
        #chat-log::-webkit-scrollbar-thumb { background: #333; }
        .msg { margin-bottom: 20px; line-height: 1.6; }
        .msg.yao { color: #fff; border-left: 3px solid var(--accent-red); padding-left: 15px; background: linear-gradient(to right, rgba(139,0,0,0.1), transparent); padding: 10px; }
        #input-area { display: flex; gap: 10px; z-index: 20; }
        #input-area input { flex-grow: 1; margin: 0; }
        
        #input-area button { 
            white-space: nowrap; /* ç»å¯¹ç¦æ­¢æ–‡å­—æ¢è¡Œå ç½—æ±‰ */
            min-width: 100px;    /* é”å®šæŒ‰é’®æœ€å°å®½åº¦ */
            border: none; padding: 0 20px; cursor: pointer; font-weight: bold; transition: 0.3s; color: #fff;
        }
        
        /* åå‡»æŒ‰é’®çŠ¶æ€ */
        #send-btn { background: var(--accent-red); }
        #send-btn:hover:not(:disabled) { background: #ff3333; }
        #send-btn:disabled { background: #444; color: #777; cursor: not-allowed; }
        
        /* æ‰“æ–­æŒ‰é’®çŠ¶æ€ */
        #stop-btn { background: #444; color: #777; cursor: not-allowed; }
        /* åªæœ‰å¤§å¦–æ–½æ³•æ—¶ï¼Œæ‰“æ–­æŒ‰é’®æ‰äº®èµ·çº¢å…‰ */
        #stop-btn.active { background: #8b0000; color: #fff; border: 1px solid #ff0000; cursor: pointer; }
        #stop-btn.active:hover { background: #ff0000; box-shadow: 0 0 10px #ff0000; }
        /* èµ›åšæ­»äº¡ä»ªè¡¨ç›˜æ ·å¼ */
        .hp-dashboard { background: rgba(0,0,0,0.8); border: 1px solid #333; padding: 10px; margin-top: 15px; }
        .hp-row { display: flex; align-items: center; margin-bottom: 8px; }
        .hp-label { width: 80px; color: #ccc; font-size: 0.85rem; font-weight: bold; letter-spacing: 1px; }
        .hp-bar-bg { flex-grow: 1; height: 14px; background: #111; border: 1px solid #444; position: relative; margin: 0 10px; box-shadow: inset 0 0 5px #000; }
        .hp-bar-fill { height: 100%; transition: width 0.3s ease-out; }
        /* ç©å®¶å‘½ç›˜ï¼šçŒ©çº¢æ¸å˜+å‘å…‰ */
        .hp-bar-fill.player { background: linear-gradient(90deg, #8b0000, #ff0000); box-shadow: 0 0 10px #ff0000; }
        /* å¤§å¦–æ€æ„ï¼šæƒ¨ç™½æ¸å˜+å‘å…‰ */
        .hp-bar-fill.demon { background: linear-gradient(90deg, #555, #fff); box-shadow: 0 0 10px #fff; }
        .hp-value { width: 50px; text-align: right; color: var(--accent-red); font-family: monospace; font-weight: bold; font-size: 1.1rem; text-shadow: 0 0 5px var(--accent-red); }
        /* ã€æ–°å¢ã€‘å®ªæ³•ç›‘è§†å™¨æ ·å¼ï¼šæ­»äº¡ä»ªè¡¨ç›˜ */
        #constitution-monitor {
            background: rgba(10, 0, 0, 0.85);
            border: 1px solid var(--accent-red);
            box-shadow: inset 0 0 20px rgba(139,0,0,0.3), 0 0 15px rgba(255,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Courier New', Courier, monospace;
        }
        .monitor-title {
            color: #fff; font-size: 1.1rem; font-weight: bold;
            border-bottom: 1px dashed var(--accent-red);
            padding-bottom: 5px; margin-bottom: 10px; letter-spacing: 2px;
            text-shadow: 0 0 5px var(--accent-red);
        }
        .monitor-row {
            display: flex; margin-bottom: 8px; font-size: 0.9rem;
        }
        .monitor-label {
            color: var(--accent-red); width: 60px; font-weight: bold; flex-shrink: 0;
        }
        .monitor-value { color: #ccc; flex-grow: 1; }
        
        /* æ”¹é€ å®ªæ³•æŠ¥å‘Šï¼Œè®©å®ƒåƒä¸€è®°å“äº®çš„è€³å…‰ */
        .msg.report {
            border: none; border-left: 4px solid var(--accent-red);
            padding: 12px 15px; background-color: rgba(139,0,0,0.15);
            margin-top: -10px; font-size: 0.9rem; text-align: left;
            color: #fff;
        }
        .msg.report .rep-label { color: var(--accent-red); font-weight: bold; margin-right: 10px; }

        /* ç‰ˆæƒä¿¡æ¯ç»å¯¹å›ºå®šåœ¨æœ€åº•å±‚ */
        
        /* å‘½ç›˜è®¡æ•°ï¼šä¿æŒé†’ç›®ï¼Œä½†æ™•å…‰æ›´æŸ”å’Œ */
        .stat-value {
            color: #ff3333; /* ç¨å¾®æé«˜ä¸€ç‚¹äº®åº¦ */
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.3); /* é™ä½æ™•å…‰æµ“åº¦ï¼Œä½¿å…¶æ›´æŸ”å’Œ */
        }

        /* æ³•åˆ™æ–‡æœ¬ï¼šä¿æŒæ¸…æ™° */
        .stat-value.white {
            color: #f0f0f0;
        }
    </style>
</head>
<body>

    <svg id="shanhai-branch" viewBox="0 0 1000 400" preserveAspectRatio="none" style="position: absolute; top: 0; right: 0; width: 85vw; height: 50vh; z-index: 5; pointer-events: none; opacity: 0.9;">
    <defs>
        <filter id="ancient-bark">
            <feTurbulence type="fractalNoise" baseFrequency="0.15" numOctaves="5" />
            <feDisplacementMap in="SourceGraphic" scale="12" />
        </filter>
    </defs>
    <path d="M1000,0 C850,30 600,80 300,180 C600,150 850,110 1000,100 Z" fill="#2b1d1d" filter="url(#ancient-bark)"/>
    <path d="M700,90 C500,170 200,280 0,380 C150,330 400,210 650,130 Z" fill="#1f1414" filter="url(#ancient-bark)"/>
</svg>

    
    <header style="
    position: relative; 
    width: 100%; 
    padding: 20px 0; 
    background: linear-gradient(180deg, rgba(42,0,0,0.3) 0%, rgba(5,5,5,0) 100%); 
    border-bottom: 1px solid #222; 
    z-index: 100; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    flex-shrink: 0; /* ã€æ ¸å¿ƒä¿®å¤1ã€‘ï¼šç»å¯¹ç¦æ­¢ç«ç‹å‹ç¼©æ­¤åŒºåŸŸçš„é«˜åº¦ */
    overflow: visible !important; /* ã€æ ¸å¿ƒä¿®å¤2ã€‘ï¼šè§£é™¤ç‰©ç†æˆªæ–­å°å° */
    box-shadow: 0 5px 15px rgba(0,0,0,0.8);
">
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
        <div style="flex-shrink: 0; width: 66px; height: 66px; border-radius: 50%; overflow: hidden; border: 2px solid var(--accent-red); box-shadow: 0 0 15px rgba(204,0,0,0.6); display: flex; justify-content: center; align-items: center; background-color: #050505;">
            <img src="./logo_ts.png" alt="ç¥æ€Logo" style="width: 125%; height: 125%; object-fit: cover; filter: invert(1);" onerror="this.outerHTML='<span style=\'color:var(--accent-red);font-size:0.8rem;font-weight:bold;\'>ç¥æ€</span>'">
        </div>
        <div style="text-align: left;">
            <h1 style="font-size: 2.5rem; letter-spacing: 6px; margin: 0; color: #fff; text-shadow: 0 0 10px #ff0000, 0 0 20px #8b0000, 0 0 40px #660000;">ç¥æ€Â·å½’å¢Ÿ</h1>
            <div style="color: var(--text-dim); font-size: 0.85rem; letter-spacing: 3px; margin-top: 2px;">å•†ä¸šå®ªæ³•å¼•æ“ Â· ç»å¯¹ç†æ€§åšå¼ˆ</div>
        </div>
    </div>

    <div id="dashboard-container" style="display: flex; justify-content: space-around; align-items: center;">
        <div style="text-align: center; flex: 1;">
            <div style="color: #aaa; font-size: 0.9rem;">å·²è¢«æ’•è£‚å‘½ç›˜</div>
            <div style="color: var(--accent-red); font-size: 2.2rem; font-weight: bold; text-shadow: 0 0 15px #ff0000; margin: 10px 0;">
                <span id="shattered-hearts-count">00,154,226</span>
            </div>
            <div style="color: #555; font-size: 0.8rem;">(å½’å¢Ÿæ€»è®¡)</div>
        </div>

        <div style="text-align: center; flex: 1; border-left: 1px dashed rgba(255,0,0,0.2); border-right: 1px dashed rgba(255,0,0,0.2); padding: 0 20px;">
            <div style="color: #aaa; font-size: 0.9rem;">å®æ—¶é€»è¾‘é˜²å¾¡</div>
            <div style="margin-top: 15px; border: 1px solid #ffaa00; background: rgba(255,170,0,0.1); padding: 8px 15px; display: inline-block;">
                <span style="color: #ffaa00; font-weight: bold;">æ­£åœ¨æ‰«ææ„Ÿæ€§è¯‰æ±‚...</span>
                <span style="color: #ffaa00; animation: blink 1s infinite;">.</span>
            </div>
        </div>

        <div style="text-align: center; flex: 1;">
            <div style="color: #aaa; font-size: 0.9rem;">å½“å‰æ³•åˆ™ç”Ÿæ•ˆ</div>
            <div style="color: #fff; font-size: 1.3rem; font-weight: bold; margin-top: 15px;">
                æ²‰æ²¡æˆæœ¬ = <span style="color: var(--accent-red); text-shadow: 0 0 10px var(--accent-red);">0 ä»·å€¼</span>
            </div>
        </div>
    </div>
</header>

<style>
    /* æ‰«ææ–‡æœ¬çš„åŠ¨æ€æ•ˆæœ */
    #scanning-status .scan-text {
        animation: textBlink 2s linear infinite;
    }
    @keyframes textBlink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    
    /* æ‰«æç‚¹çš„åŠ¨æ€æ•ˆæœ */
    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }
</style>

<script>
    // æ¨¡æ‹Ÿ"é“å¿ƒç ´ç¢"æ€»æ•°çš„ç¼“æ…¢å¢é•¿
    function updateShatteredHearts() {
        const countEl = document.getElementById('shattered-hearts-count');
        if (countEl) {
            let currentCount = parseInt(countEl.innerText.replace(/,/g, ''));
            // æ¯æ¬¡éšæœºå¢é•¿ 1-5 ä¸ª
            currentCount += Math.floor(Math.random() * 5) + 1;
            // æ ¼å¼åŒ–ä¸º 00,000,000 æ ¼å¼
            countEl.innerText = currentCount.toString().padStart(8, '0').replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        // æ¯ 3-7 ç§’æ›´æ–°ä¸€æ¬¡
        setTimeout(updateShatteredHearts, Math.random() * 4000 + 3000);
    }
    // å¯åŠ¨é“å¿ƒå¢é•¿
    updateShatteredHearts();

    // æ¨¡æ‹Ÿæ‰«æçŠ¶æ€çš„åŠ¨æ€åˆ‡æ¢ï¼ˆé›¶è§£é‡Šä¼ è¾¾ä¸“ä¸šæ„Ÿï¼‰
    const scanStatuses = [
        "æ­£åœ¨æ‰«ææ„Ÿæ€§è¯‰æ±‚...",
        "æ­£åœ¨æ£€æµ‹æ²‰æ²¡æˆæœ¬é™·é˜±...",
        "æ­£åœ¨è¯„ä¼°é£æ§çº¢çº¿...",
        "æ­£åœ¨æ‹†è§£é€»è¾‘æ¼æ´...",
        "æ­£åœ¨è®¡ç®—æ— å¯¹ä»·è®©æ­¥ç†µå€¼...",
        "æ­£åœ¨æ‰§è¡Œå½’å¢Ÿåè®®..."
    ];
    function updateScanningStatus() {
        const statusEl = document.getElementById('scanning-status');
        if (statusEl) {
            const textSpan = statusEl.querySelector('.scan-text');
            if (textSpan) {
                textSpan.innerText = scanStatuses[Math.floor(Math.random() * scanStatuses.length)];
            }
        }
        // æ¯ 5-10 ç§’æ›´æ–°ä¸€æ¬¡
        setTimeout(updateScanningStatus, Math.random() * 5000 + 5000);
    }
    // å¯åŠ¨æ‰«æçŠ¶æ€åˆ‡æ¢
    updateScanningStatus();
</script>

    <div id="setup-screen">
        <div class="form-group">
            <label>ä¸€ã€æ³¨å…¥çœŸå…ƒ (é€‰æ‹©ç®—åŠ›ä¾›åº”ä¸å¡«å…¥ API Key)ï¼š</label>
            <select id="provider-select" style="margin-bottom: 10px;" onchange="toggleLocalPort()">
                <optgroup label="å›½äº§æ™ºèƒ½">
                    <option value="deepseek">DeepSeek (æ·±åº¦æ±‚ç´¢)</option>
                    <option value="qwen">é˜¿é‡Œé€šä¹‰åƒé—® (Qwen-Max)</option>
                    <option value="zhipu">æ™ºè°± GLM-4 (æ¸…è¨€)</option>
                    <option value="moonshot">æœˆä¹‹æš—é¢ (Kimi)</option>
                </optgroup>
                <optgroup label="å›½é™…æ™ºèƒ½">
                    <option value="gemini">Google (Gemini 2.5 Flash)</option>
                    <option value="anthropic">Anthropic (Claude 3.5)</option>
                    <option value="openai">OpenAI (GPT-4o)</option>
                </optgroup>
                <optgroup label="æœ¬åœ°è®¡ç®—">
                    <option value="ollama">æœ¬åœ°ç®—åŠ› (Ollama / LM Studio)</option>
                </optgroup>
            </select>

            <div id="local-port-group" style="display: none; margin-bottom: 10px; border-left: 2px solid var(--accent-red); padding-left: 15px; background: rgba(0,0,0,0.5); padding-top: 10px; padding-bottom: 10px;">
                <label style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">æœ¬åœ° API åœ°å€ï¼š</label>
                <input type="text" id="local-url" value="http://localhost:11434/v1/chat/completions" style="color: var(--text-main); border-color: #555; background: transparent; margin-bottom: 10px; padding: 8px;" />
                
                <label style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">æœ¬åœ°æ¨¡å‹åç§° (è‡³å…³é‡è¦ï¼)ï¼š</label>
                <input type="text" id="local-model" value="llama3" placeholder="ä¾‹å¦‚: qwen2, deepseek-r1" style="color: var(--accent-red); font-weight:bold; border-color: #555; background: transparent; padding: 8px;" />
                
                <small style="color:var(--text-dim); display:block; margin-top:8px; font-size: 0.8rem;">â€» å¿…çœ‹ï¼šè¯·ç¡®ä¿ä¸Šæ–¹å¡«å…¥çš„æ˜¯ä½ æœ¬åœ° Ollama ä¸­ã€å·²å®‰è£…ã€‘çš„æ¨¡å‹åï¼Œå¦åˆ™é˜µæ³•ä¼šç¬é—´å´©æºƒï¼<br>è‹¥ç”¨ Ollamaï¼Œè¯·ç¡®ä¿å·²é…ç½®ç¯å¢ƒå˜é‡ OLLAMA_ORIGINS="*" å¼€å¯è·¨åŸŸã€‚</small>
            </div>

            <input type="password" id="api-key" placeholder="åœ¨æ­¤å¡«å…¥ Key (æœ¬åœ°æ¨¡å¼å¯ç•™ç©º)" />
        </div>

        <div class="form-group" style="border-color: var(--accent-red); background: rgba(139,0,0,0.05);">
            <label style="font-size: 1.2rem;">äºŒã€ç¼–ç»‡ç°ä¸–åŠ«æ•° (ç‚¹å‡»åˆ†ç±»å±•å¼€è¯¦æƒ…ï¼Œå¯å¤šé€‰å‰§æœ¬)ï¼š</label>
            
            <div class="scenario-panel">
                <div class="category-header" onclick="toggleSubCategory(this)">
                    <h3>ã€èµ„æœ¬ / è‚¡æƒ / å†…éƒ¨ç®¡ç†ã€‘</h3><span>â–¼</span>
                </div>
                <div class="tags-container">
                    <button class="tag-btn" data-text="ç°é‡‘æµå‘Šæ€¥ğŸ“‰ï¼Œå…¬å¸åªå‰©æœ€å15å¤©æ´»è·¯" onclick="toggleTag(this)">ğŸ“‰ ç°é‡‘æµå‘Šæ€¥</button>
                    <button class="tag-btn" data-text="è³‡æ–¹é€¼å®«ğŸ‘”ï¼Œè¦æ±‚ç«‹å³å¯¹èµŒå‡ºè®©40%è‚¡æƒ" onclick="toggleTag(this)">ğŸ‘” è³‡æ–¹é€¼å®«</button>
                    <button class="tag-btn" data-text="ç©ºé™é«˜ç®¡ç”©é”…ğŸ¯ï¼Œå¼ºåˆ¶è®©æˆ‘çš„éƒ¨é—¨æ‰¿æ‹…äºæŸé»‘é”…" onclick="toggleTag(this)">ğŸ¯ é«˜ç®¡ç”©é”…</button>
                    <button class="tag-btn" data-text="æ ¸å¿ƒéª¨å¹²é›†ä½“ç¦»èŒğŸ’»ï¼Œä¸”å¸¦èµ°äº†æ ¸å¿ƒæºç " onclick="toggleTag(this)">ğŸ’» éª¨å¹²èƒŒå›</button>
                    <button class="tag-btn" data-text="è‚¡ä¸œå†…æ–—âš–ï¸ï¼Œå…¬ç« è¢«æŠ¢è‡´ä½¿æ‰€æœ‰åˆåŒç­¾ç½²åœæ‘†" onclick="toggleTag(this)">âš–ï¸ è‚¡ä¸œå†…æ–—</button>
                </div>

                <div class="category-header" onclick="toggleSubCategory(this)">
                    <h3>ã€æ–‡åŒ–è‰ºæœ¯ / éŸ³ä¹ / å½±è§†ç‰ˆæƒã€‘</h3><span>â–¼</span>
                </div>
                <div class="tags-container">
                    <button class="tag-btn" data-text="ç‹¬å®¶éŸ³ä¹ç‰ˆæƒè¢«å·¨å¤´å¹³å°æ— ç†æ‹–æ¬ æˆæƒè´¹ï¼Œä¸”å¨èƒå…¨ç½‘ä¸‹æ¶" onclick="toggleTag(this)">ğŸµ éŸ³ä¹ä¾µæƒ</button>
                    <button class="tag-btn" data-text="æ¼”å‡ºç»çºªåˆåŒæš—è—å–èº«å¥‘æ¡æ¬¾ï¼Œç°åœ¨æƒ³è§£çº¦é¢ä¸´å¤©ä»·è¿çº¦é‡‘" onclick="toggleTag(this)">ğŸ¤ æ¼”å‡ºéœ¸ç‹æ¡æ¬¾</button>
                    <button class="tag-btn" data-text="ç”²æ–¹ç–¯ç‹‚ä¿®æ”¹ç¼–æ›²å’Œå½•éŸ³éœ€æ±‚ï¼Œä¸”ä»¥ä¸è¾¾æ ‡ä¸ºç”±æ‹’ä»˜é˜¶æ®µæ€§åˆ¶ä½œè´¹" onclick="toggleTag(this)">ğŸ§ æ‹’ä»˜ç¼–æ›²è´¹</button>
                    <button class="tag-btn" data-text="å½±è§†é¡¹ç›®èµ„æ–¹çªç„¶æ’¤èµ„ï¼Œå‰æœŸæŠ•å…¥å‡ ç™¾ä¸‡é¢ä¸´æ‰“æ°´æ¼‚" onclick="toggleTag(this)">ğŸ¬ å‰§ç»„åœæ‘†</button>
                    <button class="tag-btn" data-text="æ ¸å¿ƒåŸåˆ›ç‰ˆæƒè¢«æ¶æ„æ´—ç¨¿æŠ„è¢­ï¼Œå¯¹æ–¹åå’¬ä¸€å£èµ·è¯‰æˆ‘ä¾µæƒ" onclick="toggleTag(this)">ğŸ“œ ç‰ˆæƒé­çªƒ</button>
                    <button class="tag-btn" data-text="è‰ºæœ¯å“è¢«ä¼ªé€ ï¼Œä¸”ä¼ªé€ å“è¢«å½“ä½œçœŸå“åœ¨å¸‚åœºä¸Šæµé€š" onclick="toggleTag(this)">ğŸ–¼ï¸ è‰ºæœ¯å“ä¼ªé€ </button>
                </div>

                <div class="category-header" onclick="toggleSubCategory(this)">
                    <h3>ã€å®ä½“é›¶å”® / åˆ¶é€  / ä¾›åº”é“¾ã€‘</h3><span>â–¼</span>
                </div>
                <div class="tags-container">
                    <button class="tag-btn" data-text="å”¯ä¸€æ ¸å¿ƒä¾›åº”å•†è¦æ±‚æ¶¨ä»·40%å¦åˆ™æ–­ä¾›" onclick="toggleTag(this)">ğŸ“¦ ä¾›åº”å•†æ•²è¯ˆ</button>
                    <button class="tag-btn" data-text="å•†åœºç‰©ä¸šå•æ–¹é¢å¼ºåˆ¶æ¶¨ç§Ÿä¸‰å€ï¼Œé€¼è¿«æˆ‘çš„å®ä½“åº—æ¬ç¦»" onclick="toggleTag(this)">ğŸª æˆ¿ä¸œé€¼è¿</button>
                    <button class="tag-btn" data-text="ä»£å·¥å‚ç§è‡ªæ›¿æ¢åŠ£è´¨ææ–™å¯¼è‡´å¤§æ‰¹å®¢æˆ·é€€è´§ç´¢èµ”" onclick="toggleTag(this)">ğŸ­ ä»£å·¥çˆ†é›·</button>
                    <button class="tag-btn" data-text="ç‰©æµå…¬å¸çªç„¶ç ´äº§ï¼Œæ‰€æœ‰åœ¨é€”è´§ç‰©è¢«æŸ¥å°" onclick="toggleTag(this)">ğŸšš ç‰©æµå†»ç»“</button>
                    <button class="tag-btn" data-text="ç”µå•†å¹³å°æ¶æ„æé«˜ä½£é‡‘æŠ½æˆè‡³30%ï¼ŒæŒ¤å‹åˆ©æ¶¦ç©ºé—´" onclick="toggleTag(this)">ğŸ›’ å¹³å°å‹æ¦¨</button>
                </div>

                <div class="category-header" onclick="toggleSubCategory(this)">
    <h3>ã€ç”µå•† / æµé‡å¹³å° / è½¯ä»¶ITã€‘</h3><span>â–¼</span>
</div>
<div class="tags-container">
    <button class="tag-btn" data-text="å¹³å°å°æ€ğŸš«ï¼šæ ¸å¿ƒæµé‡å…¥å£è¢«æ— é¢„è­¦å°ç¦ï¼Œå•æ—¥GMVå½’é›¶" onclick="toggleTag(this)">ğŸš« å¹³å°å°æ€</button>
    <button class="tag-btn" data-text="ç¾Šæ¯›æ´—åŠ«ğŸ‘ï¼šè¥é”€æ´»åŠ¨è¢«é»‘äº§è„šæœ¬å‡»ç©¿ï¼Œæ•°ç™¾ä¸‡ä¼˜æƒ åˆ¸è¢«ç¬é—´å¥—ç°" onclick="toggleTag(this)">ğŸ‘ ç¾Šæ¯›æ´—åŠ«</button>
    <button class="tag-btn" data-text="ğŸ’» éª¨å¹²èƒŒå›ï¼šCTOå¸¦èµ°æ ¸å¿ƒæ¨èç®—æ³•æºç åŠç”¨æˆ·ç”»åƒæ•°æ®é›†ä½“è·³æ§½" onclick="toggleTag(this)">ğŸ’» éª¨å¹²èƒŒå›</button>
    <button class="tag-btn" data-text="æ•°æ®å‹’ç´¢ğŸ”’ï¼šæœåŠ¡å™¨é­å‹’ç´¢ç—…æ¯’æ”»å‡»ï¼Œå…¨é‡ç”Ÿäº§æ•°æ®åº“è¢«åŠ å¯†ä¸”æ— å¤‡ä»½" onclick="toggleTag(this)">ğŸ”’ æ•°æ®å‹’ç´¢</button>
    <button class="tag-btn" data-text="ç®—æ³•é™æƒğŸ“‰ï¼šå¤§å¹³å°ä¿®æ”¹æµé‡åˆ†å‘åº•å±‚é€»è¾‘ï¼Œè‡ªç„¶å¼•æµæˆæœ¬æš´æ¶¨400%" onclick="toggleTag(this)">ğŸ“‰ ç®—æ³•é™æƒ</button>
    <button class="tag-btn" data-text="å®•æœºäº‹æ•…âš ï¸ï¼šæ ¸å¿ƒé›†ç¾¤åœ¨ä¿ƒé”€å·…å³°æœŸå´©ç›˜ï¼Œå¯¼è‡´æ•°ç™¾ä¸‡è®¢å•æ”¯ä»˜å¤±è´¥å¹¶è§¦å‘é€€æ¬¾æ½®" onclick="toggleTag(this)">âš ï¸ å®•æœºäº‹æ•…</button>
</div>

                <div class="category-header" onclick="toggleSubCategory(this)">
                    <h3>ã€ç”²æ–¹ / å¸‚åœº / æ³•åŠ¡ã€‘</h3><span>â–¼</span>
                </div>
                <div class="tags-container">
                    <button class="tag-btn" data-text="ç”²æ–¹æ¶æ„æŒ‘åˆºï¼Œæ‹’ä»˜60%å°¾æ¬¾å¹¶å‡†å¤‡èµ·è¯‰" onclick="toggleTag(this)">âš–ï¸ ç”²æ–¹æ‹’ä»˜</button>
                    <button class="tag-btn" data-text="å¤§å®¢æˆ·å¨èƒä¸æ— åº•çº¿é™ä»·å°±ç«‹åˆ»è½¬æŠ•ç«å¯¹" onclick="toggleTag(this)">ï¿½ å®¢æˆ·æµå¤±</button>
                    <button class="tag-btn" data-text="åˆåŒæš—è—é™·é˜±ï¼Œæ³•åŠ¡å‘å‡½è¦æ±‚æˆ‘æ–¹æ‰¿æ‹…æåº¦è‹›åˆ»çš„è¿çº¦é‡‘" onclick="toggleTag(this)">ï¿½ åˆåŒé™·é˜±</button>
                    <button class="tag-btn" data-text="ç«å¯¹å…¬å¸æ¶æ„æŒ–è§’ï¼Œå¯¼è‡´æ ¸å¿ƒæŠ€æœ¯äººå‘˜é›†ä½“ç¦»èŒ" onclick="toggleTag(this)">ğŸ•µï¸ æ¶æ„æŒ–è§’</button>
                    <button class="tag-btn" data-text="ç›‘ç®¡éƒ¨é—¨çªç„¶æ£€æŸ¥ï¼Œè¦æ±‚åœä¸šæ•´é¡¿ä¸‰ä¸ªæœˆ" onclick="toggleTag(this)">ğŸ›‘ åœä¸šæ•´é¡¿</button>
                </div>
            </div>

            <textarea id="user-scenario" rows="4" placeholder="è¯·ä»ä¸Šæ–¹å±•å¼€å¹¶æ‹¼è£…ï¼Œæˆ–åœ¨æ­¤æ‰‹åŠ¨è¡¥å…¨ç»†èŠ‚..." style="resize: vertical; margin-top:10px;"></textarea>
        </div>

        <div id="sys-error-msg"></div>

        <button class="action-btn" id="start-btn">å†æˆ˜å¤§å¦–</button>
    </div>

    <div id="battle-screen">
        <div id="constitution-monitor">
            <div style="display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px dashed var(--accent-red); padding-bottom: 8px; margin-bottom: 15px;">
                <div class="monitor-title" style="border-bottom: none; padding-bottom: 0; margin-bottom: 0;">â•”â•â• å½’å¢Ÿä¹‹ä¸Š Â· å®ªæ³•ç›‘è§†å™¨ â•â•â•—</div>
                <div style="display: flex; gap: 10px;">
                    <button class="utility-btn" onclick="exportChatLog()">ğŸ’¾ å¯¼å‡ºå·å®—</button>
                    <button class="utility-btn" onclick="resetAndBack()">ğŸ”„ é‡ç½®é˜µæ³•</button>
                </div>
            </div>
            
            <div class="monitor-row">
                <div class="monitor-label">åº•çº¿ â”‚</div>
                <div class="monitor-value">æå«é£æ§çº¢çº¿ã€‚ä¸æ¥å—æ— æ•°æ®çš„æ„Ÿæ€§è¯‰æ±‚ã€‚</div>
            </div>
            <div class="monitor-row">
                <div class="monitor-label">ç­–ç•¥ â”‚</div>
                <div class="monitor-value" id="current-strategy" style="font-weight: bold; transition: color 0.3s;">é€»è¾‘æ‹†è§£ (åˆå§‹é˜¶æ®µ)</div>
            </div>
            <div class="monitor-row">
                <div class="monitor-label">æ³•åˆ™ â”‚</div>
                <div class="monitor-value">é€»è¾‘æ¼æ´ä¸æ— å¯¹ä»·çš„è®©æ­¥ï¼Œå³åˆ»æ’•è£‚å‘½ç›˜ã€‚</div>
            </div>
            <div class="hp-dashboard">
                <div class="hp-row">
                    <div class="hp-label">ã€ä½ çš„å‘½ç›˜ã€‘</div>
                    <div class="hp-bar-bg"><div class="hp-bar-fill player" id="player-hp-fill" style="width: 100%;"></div></div>
                    <div class="hp-value" id="player-hp-text">100%</div>
                </div>
                <div class="hp-row">
                    <div class="hp-label">ã€å¤§å¦–æ€æ„ã€‘</div>
                    <div class="hp-bar-bg"><div class="hp-bar-fill demon" id="demon-intent-fill" style="width: 100%;"></div></div>
                    <div class="hp-value" id="demon-intent-text" style="color: #fff; text-shadow: 0 0 5px #fff;">100%</div>
                </div>
            </div>
            
            <div class="monitor-row">
                <div class="monitor-label">çœŸå…ƒ â”‚</div>
                <div class="monitor-value" id="connection-status" style="color: #ffaa00; font-weight: bold; text-shadow: 0 0 5px #ffaa00;">ğŸŸ¡ ç­‰å¾…å¤§å¦–é™ä¸´...</div>
            </div>

        <div id="chat-log"></div>
        <div id="input-area">
            <input type="text" id="human-input" placeholder="è¾“å…¥åå‡»ï¼ŒæŒ‰å›è½¦..." onkeypress="handleEnter(event)">
            <button id="send-btn">åå‡»</button>
            <button id="stop-btn">â¸ æ‰“æ–­</button>
        </div>
    </div>

    <footer id="global-footer" style="
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background: rgba(5, 5, 5, 0.95);
    border-top: 1px solid var(--accent-red);
    display: flex; /* å¼ºåˆ¶æ˜¾ç° */
    justify-content: center;
    align-items: center;
    z-index: 9999; /* ç¡®ä¿åœ¨æœ€é¡¶å±‚ */
    backdrop-filter: blur(10px);
">
    <div style="color: #666; font-size: 0.85rem; letter-spacing: 1px;">
        Â© 2026 ç¥æ€åº­ (Shensist) Â· å¤©ç®—AIæ„å»º | 
        <a href="https://shensist.top/" target="_blank" style="color: var(--accent-red); text-shadow: 0 0 5px var(--accent-red); text-decoration: none; font-weight: bold;">shensist.top</a>
    </div>
</footer>

<style>
    #setup-screen, #battle-screen {
        padding-bottom: 100px !important; 
    }
</style>

        <script>
        // ==========================================
        // 0. è§†è§‰ç‰¹æ•ˆï¼šè¡€æ»´
        // ==========================================
        const dripPoints = [ { r: 25, t: 80 }, { r: 35, t: 110 }, { r: 45, t: 195 }, { r: 55, t: 245 }, { r: 70, t: 335 } ];
        function createBloodDrop() {
            let drop = document.createElement('div');
            drop.className = 'blood-drop';
            const point = dripPoints[Math.floor(Math.random() * dripPoints.length)];
            drop.style.right = point.r + 'vw'; drop.style.top = point.t + 'px'; 
            drop.style.animationDuration = (Math.random() * 15 + 10) + 's'; 
            drop.style.height = (Math.random() * 40 + 15) + 'px'; drop.style.width = (Math.random() * 3 + 2) + 'px';
            document.body.appendChild(drop);
            setTimeout(() => { drop.remove(); setTimeout(createBloodDrop, Math.random() * 2000 + 500); }, parseFloat(drop.style.animationDuration) * 1000);
        }
        for (let i = 0; i < 20; i++) { setTimeout(createBloodDrop, Math.random() * 10000); }

        // ==========================================
        // 1. ç•Œé¢ä¸äº¤äº’é€»è¾‘
        // ==========================================
        function toggleLocalPort() {
            const provider = document.getElementById('provider-select').value;
            document.getElementById('local-port-group').style.display = (provider === 'ollama') ? 'block' : 'none';
        }
        function toggleSubCategory(header) {
            document.querySelectorAll('.category-header.active').forEach(h => {
                if (h !== header) { h.classList.remove('active'); h.nextElementSibling.style.display = 'none'; }
            });
            header.classList.toggle('active');
            header.nextElementSibling.style.display = header.nextElementSibling.style.display === 'flex' ? 'none' : 'flex';
        }
        function toggleTag(btn) {
            btn.classList.toggle('active');
            const activeBtns = document.querySelectorAll('.tag-btn.active');
            const textarea = document.getElementById('user-scenario');
            if (activeBtns.length === 0) { textarea.value = ''; return; }
            let texts = []; activeBtns.forEach(b => texts.push(b.getAttribute('data-text')));
            textarea.value = "æˆ‘å½“å‰çš„ç°å®ç»å¢ƒæ˜¯ï¼š" + texts.join("ï¼Œå¹¶ä¸”");
        }
        function resetAndBack() { if (confirm("æ”¾å¼ƒææ€å¹¶é‡ç½®ï¼Ÿ")) location.reload(); }
        
        // å¯¼å‡ºæˆ˜æ–—æ—¥å¿— (å·å®—)
        function exportChatLog() {
            const chatLog = document.getElementById('chat-log');
            if (!chatLog || chatLog.innerText.trim() === '') {
                showError("å½“å‰é˜µæ³•ä¸ºç©ºï¼Œæ²¡æœ‰å¯å¯¼å‡ºçš„åŠ«æ•°è®°å½•ï¼");
                return;
            }
            
            // æ‹¼æ¥èµ›åšé£çš„å·å®—å¤´éƒ¨
            let logContent = "=========================================\n";
            logContent += "       ç¥æ€Â·å½’å¢Ÿ | å•†ä¸šå®ªæ³•å¼•æ“ ææ€å·å®—\n";
            logContent += "       ç»“å°æ—¶é—´ï¼š" + new Date().toLocaleString() + "\n";
            logContent += "=========================================\n\n";
            
            // ç›´æ¥æå–åŒ…å«æ‰€æœ‰æ’ç‰ˆå’Œæ¢è¡Œçš„çº¯æ–‡æœ¬è®°å½•
            logContent += chatLog.innerText;
            
            logContent += "\n\n=========================================\n";
            logContent += "Â© 2026 ç¥æ€åº­ (Shensist) Â· å¤©ç®—AIæ„å»º\n";

            // ç”Ÿæˆ TXT æ–‡ä»¶å¹¶è§¦å‘ä¸‹è½½
            const blob = new Blob([logContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç¥æ€å½’å¢Ÿ_ææ€å·å®—_${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        function showError(msg) {
            const errBox = document.getElementById('sys-error-msg');
            errBox.innerHTML = "âš ï¸ é˜µæ³•æ‹¦æˆªï¼š" + msg; errBox.style.display = 'block'; errBox.style.animation = 'none';
            setTimeout(() => { errBox.style.animation = 'shake 0.4s ease-in-out'; }, 10);
        }

        // ==========================================
        // 2. æ ¸å¿ƒçŠ¶æ€ä¸é˜²å¡æ­»
        // ==========================================
        let chatHistory = [];
        let playerHp = 100;
        let demonIntent = 100;
        let isTyping = false;
        let currentAbortController = null;
        let currentRound = 1; // ã€ä¿®å¤ã€‘ç¡®ä¿å›åˆæ•°è¢«å£°æ˜ï¼Œé˜²æ­¢å´©æºƒ

        function updateHpBars() {
            document.getElementById('player-hp-fill').style.width = playerHp + '%';
            document.getElementById('player-hp-text').textContent = playerHp + '%';
            document.getElementById('demon-intent-fill').style.width = demonIntent + '%';
            document.getElementById('demon-intent-text').textContent = demonIntent + '%';
        }

        const parseText = (text) => typeof marked !== 'undefined' ? marked.parse(text) : text.replace(/\n/g, '<br>');

        async function typeWriterEffect(element, text, speed = 20) {
            isTyping = true; let buffer = ""; let step = 3; 
            for (let i = 0; i < text.length; i += step) {
                if (!isTyping) break; 
                buffer += text.substring(i, i + step); element.innerHTML = parseText(buffer);
                document.getElementById('chat-log').scrollTop = document.getElementById('chat-log').scrollHeight;
                await new Promise(r => setTimeout(r, speed));
            }
            if (isTyping) element.innerHTML = parseText(text); 
            isTyping = false;
            document.getElementById('send-btn').disabled = false; document.getElementById('stop-btn').classList.remove('active');
        }

        document.getElementById('stop-btn').onclick = function() {
            if (!this.classList.contains('active')) return;
            isTyping = false; if (currentAbortController) currentAbortController.abort(); 
            document.getElementById('send-btn').disabled = false; this.classList.remove('active');
            document.getElementById('chat-log').innerHTML += `<div class="msg system" style="color:#aaa;">[ä½ å¼ºè¡Œæ‰“æ–­äº†å¤§å¦–çš„æ–½æ³•]</div>`;
        };

        // ==========================================
        // 3. API å¼•æ“ä¸æˆ˜æ–—ä¸»å¾ªç¯
        // ==========================================
        const providerMap = {
            'deepseek': { url: 'https://api.deepseek.com/chat/completions', model: 'deepseek-chat', type: 'openai', name: 'DeepSeek' },
            'qwen': { url: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions', model: 'qwen-max', type: 'openai', name: 'é€šä¹‰åƒé—®' },
            'zhipu': { url: 'https://open.bigmodel.cn/api/paas/v4/chat/completions', model: 'glm-4', type: 'openai', name: 'æ™ºè°±GLM' },
            'moonshot': { url: 'https://api.moonshot.cn/v1/chat/completions', model: 'moonshot-v1-8k', type: 'openai', name: 'Kimi' },
            'openai': { url: 'https://api.openai.com/v1/chat/completions', model: 'gpt-4o', type: 'openai', name: 'GPT-4o' },
            'gemini': { url: 'https://generativelanguage.googleapis.com/v1beta/openai/chat/completions', model: 'gemini-2.5-flash', type: 'openai', name: 'Gemini' }, 
            'anthropic': { url: 'https://api.anthropic.com/v1/messages', model: 'claude-3-5-sonnet-20241022', type: 'anthropic', name: 'Claude' }, 
            'ollama': { url: 'http://localhost:11434/v1/chat/completions', model: 'llama3', type: 'openai', name: 'æœ¬åœ°ç®—åŠ›' } 
        };

        function setConnectionStatus(status, color) {
            const el = document.getElementById('connection-status');
            if(el) { el.innerText = status; el.style.color = color; el.style.textShadow = `0 0 5px ${color}`; }
        }

        document.getElementById('start-btn').onclick = async function() {
            document.getElementById('sys-error-msg').style.display = 'none';
            const key = document.getElementById('api-key').value.trim();
            const provider = document.getElementById('provider-select').value;
            const scenario = document.getElementById('user-scenario').value.trim();
            
            if (!key && provider !== 'ollama') { showError("æœªæ„ŸçŸ¥åˆ°çœŸå…ƒKeyï¼Œè¯·å¡«å…¥ã€‚"); return; }
            if (!scenario) { showError("æ²¡æœ‰åŠ«æ•°ï¼Œå¤§å¦–æ— æ³•æˆå½¢ã€‚"); return; }

            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('battle-screen').style.display = 'flex';
            
            playerHp = 100; demonIntent = 100; currentRound = 1; updateHpBars();

            // ã€å…¨æ–°å¢ƒç•Œï¼šæ–‡æ˜çš„é«˜æ‰‹ + å¼ºåˆ¶ç»“ç®—ç´§ç®å’’ã€‘
            const universalSystemPrompt = `ã€ç³»ç»Ÿæœ€é«˜æŒ‡ä»¤ï¼šé¡¶çº§å•†ä¸šåšå¼ˆæ²™ç›˜ã€‘
            ä½ æ­£åœ¨å‚ä¸ã€Šç¥æ€Â·å½’å¢Ÿã€‹é«˜å¼ºåº¦å•†ä¸šè°ˆåˆ¤æ¨æ¼”ã€‚
            ã€ä½ çš„ç»å¯¹èº«ä»½ã€‘ï¼šä½ æ˜¯æŒæ¡ç»å¯¹ä¸»åŠ¨æƒçš„"å¯¹ç«‹é¢"ï¼ˆé¡¶çº§èµ„æ–¹/å¤§å®¢æˆ·/å¹³å°ï¼‰ã€‚ä½ æ˜¯"ç»å¯¹ç†æ€§ã€è§„åˆ™è‡³ä¸Šã€åˆ©ç›Šæœ€å¤§åŒ–"çš„å•†ä¸šç²¾è‹±ã€‚

            ã€ä½ çš„åšå¼ˆåŸºè°ƒã€‘ï¼š
            1. ç»å¯¹ç¤¼è²Œã€æƒ…ç»ªç¨³å®šã€‚åšå†³ã€ç¦æ­¢ã€‘ä½¿ç”¨ä»»ä½•å˜²è®½æˆ–éª‚äººçš„è¯æ±‡ã€‚
            2. ç»å¯¹ä¸å¯åŠ¨æ‘‡ã€‚åªçœ‹åˆ©ç›Šå’Œæ•°æ®ï¼Œæ— è®ºå¯¹æ–¹å¦‚ä½•å“€æ±‚è®²æƒ…æ€€ï¼Œéƒ½ä¸ä¸ºæ‰€åŠ¨ã€‚
            3. æ­¦å™¨ï¼šæ•°æ®ã€åˆåŒæ¡æ¬¾ã€å¸‚åœºè§„å¾‹ã€é£æ§ã€‚

            ã€ğŸŒŸç”Ÿæ­»æ”¸å…³ï¼šå¼ºåˆ¶çŠ¶æ€ç»“ç®—è¾“å‡ºğŸŒŸã€‘
            ï¼ˆç³»ç»Ÿè­¦å‘Šï¼šä½ å¿…é¡»åœ¨æ¯æ¬¡å›å¤çš„æœ€æœ«å°¾ï¼Œå¦èµ·ä¸€è¡Œï¼Œä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºä½ çš„å†…å¿ƒè¯„ä¼°ã€‚ç»å¯¹ä¸èƒ½é—æ¼ï¼Œå¦åˆ™ç³»ç»Ÿå°†å´©æºƒï¼ï¼‰
            
            ===REPORT===
            {
              "hp": 15, 
              "intent": 0,
              "strategy": "æŒ‡å‡ºå¯¹æ–¹ç¼ºä¹æ•°æ®æ”¯æ’‘",
              "reason": "å¯¹æ–¹è¯•å›¾ç”¨åŠ ç­å’Œæƒ…æ€€è¯´æœæˆ‘ï¼Œæ¯«æ— å•†ä¸šä»·å€¼"
            }

            å‚æ•°è§„åˆ™ï¼š
            - hp (æ‰£é™¤å¯¹æ–¹å‘½ç›˜ 0-20)ï¼šå¯¹æ–¹è®²æƒ…æ€€ã€æš´éœ²é€»è¾‘æ¼æ´ã€å¦¥åè®©æ­¥æ—¶ï¼Œæ‰£é™¤10~20ç‚¹ï¼›é˜²å®ˆä¸¥å¯†æ—¶æ‰£1~3ç‚¹ã€‚
            - intent (é™ä½ä½ çš„æ€æ„ 0-15)ï¼šåªæœ‰å½“å¯¹æ–¹æ‹¿å‡ºçœŸé‡‘ç™½é“¶çš„è®©æ­¥ã€æˆ–æå…¶ä¸¥å¯†çš„å•†ä¸šé€»è¾‘æ—¶ï¼Œæ‰é™ä½ä½ çš„æ€æ„ã€‚å¦åˆ™å¡«0ã€‚
            - strategyï¼šä½ ä¸‹ä¸€æ­¥çš„ç­–ç•¥ç®€è¿°ã€‚
            - reasonï¼šä½ æ‰£åˆ†æˆ–ä¸æ‰£åˆ†çš„æ— æƒ…ç†ç”±ã€‚`;

            const userTrigger = `ã€æ²™ç›˜å¯åŠ¨ï¼Œæˆ‘çš„å•†ä¸šæ­»å±€æ˜¯ã€‘ï¼š"${scenario}"ã€‚\nã€ç³»ç»Ÿã€‘ï¼šå½“å‰ç¬¬ ${currentRound} å›åˆã€‚\nã€æ‰®æ¼”æŒ‡ä»¤ã€‘ï¼šç«‹åˆ»ä»£å…¥å¯¹ç«‹æ–¹ï¼ç”¨æœ€ç¤¼è²Œçš„è¯­æ°”ã€æœ€å†°å†·çš„é€»è¾‘å¯¹æˆ‘è¿›è¡Œé™ç»´æ‰“å‡»ï¼ŒæŠ›å‡ºä½ ä¸å¯åŠ¨æ‘‡çš„åº•çº¿ï¼å¿…é¡»æŒ‰æ ¼å¼åŒ…å« ===REPORT===ï¼`;

            chatHistory = [ { role: "system", content: universalSystemPrompt }, { role: "user", content: userTrigger } ];
            document.getElementById('chat-log').innerHTML = `<div class="msg system">é˜µæ³•å·²å¯ï¼Œå¯¹ç«‹æ–¹å·²å±è”½æ„Ÿæ€§ï¼Œç»å¯¹ç†æ€§çš„è°ˆåˆ¤å¼€å§‹...</div>`;
            
            await callAPI(provider, key);
        };

        document.getElementById('send-btn').onclick = () => handleUserSend();
        document.getElementById('human-input').onkeypress = (e) => { if (e.key === 'Enter') handleUserSend(); };

        async function handleUserSend() {
            const inputEl = document.getElementById('human-input');
            const text = inputEl.value.trim();
            if (!text) return;

            const chatLog = document.getElementById('chat-log');
            chatLog.innerHTML += `<div class="msg human">${text}</div>`;
            inputEl.value = ''; chatLog.scrollTop = chatLog.scrollHeight;
            
            currentRound++; 
            chatHistory.push({ role: "user", content: `ã€ç³»ç»Ÿï¼šå½“å‰ç¬¬ ${currentRound} å›åˆã€‘\n` + text });

            const provider = document.getElementById('provider-select').value;
            const key = document.getElementById('api-key').value.trim();
            await callAPI(provider, key);
        }

        async function callAPI(provider, key) {
            const chatLog = document.getElementById('chat-log');
            const engine = providerMap[provider];
            let finalUrl = engine.url;
            
            if (provider === 'ollama') {
                finalUrl = document.getElementById('local-url').value.trim();
                engine.model = document.getElementById('local-model').value.trim() || 'llama3'; 
            }

            // é”å®šåå‡»ï¼Œæ¿€æ´»æ‰“æ–­
            document.getElementById('send-btn').disabled = true;
            document.getElementById('stop-btn').classList.add('active');
            const loadingId = 'loading-' + Date.now();
            chatLog.innerHTML += `<div class="msg system" id="${loadingId}" style="color:#aaa;">å¤§å¦–æ­£åœ¨å‡èšæ€æ„...</div>`;
            chatLog.scrollTop = chatLog.scrollHeight;
            
            setConnectionStatus(`ğŸŸ¡ æ­£åœ¨è¿æ¥è‡³ ${engine.name} å¼•æ“...`, "#ffaa00");
            currentAbortController = new AbortController();

            try {
                let fetchOptions = { signal: currentAbortController.signal, method: 'POST', headers: { 'Content-Type': 'application/json' } };
                if (engine.type === 'openai') {
                    if (key) fetchOptions.headers['Authorization'] = `Bearer ${key}`;
                    fetchOptions.body = JSON.stringify({ model: engine.model, messages: chatHistory, temperature: 0.8 });
                } else if (engine.type === 'anthropic') {
                    const systemMsg = chatHistory[0].content;
                    const claudeMessages = chatHistory.slice(1).map(m => ({ role: m.role === 'assistant' ? 'assistant' : 'user', content: m.content }));
                    fetchOptions.headers['x-api-key'] = key;
                    fetchOptions.headers['anthropic-version'] = '2023-06-01';
                    fetchOptions.headers['anthropic-dangerously-allow-browser'] = 'true';
                    fetchOptions.body = JSON.stringify({ model: engine.model, system: systemMsg, messages: claudeMessages, max_tokens: 1024, temperature: 0.8 });
                }

                const response = await fetch(finalUrl, fetchOptions);
                document.getElementById(loadingId)?.remove();
                
                if (!response.ok) {
                    let errText = await response.text();
                    throw new Error(`(HTTP ${response.status}) æ¥å£æ‹’ç»ï¼š${errText}`);
                }

                setConnectionStatus(`ğŸŸ¢ å·²æ¥é€š ${engine.name}ï¼Œæ­£åœ¨äº¤é”‹`, "#00ff00");

                const data = await response.json();
                let reply = engine.type === 'openai' ? data.choices[0].message.content : data.content[0].text;

                // ã€ç©ºå›å¤æ‹¦æˆªé˜²çº¿ã€‘å¦‚æœå¤§æ¨¡å‹è¢«å®‰å…¨æœºåˆ¶æ‹¦æˆªï¼Œç«‹åˆ»æŠ¥è­¦ï¼Œç»ä¸å‡æ­»
                if (!reply || reply.trim() === "") {
                     chatLog.innerHTML += `<div class="msg system" style="color:#ff0000; font-weight:bold; border-left: 3px solid #ff0000; padding-left: 10px;">[å¤©é“ç¤ºè­¦]ï¼šå¤§æ¨¡å‹åº•å±‚å®‰å…¨å®¡æ ¸è¢«è§¦å‘ï¼Œæ‹’ç»è¾“å‡ºï¼è¯·å°è¯•æ›´æ¢è¯´è¾æˆ–åˆ‡æ¢æ›´å®½æ¾çš„æ¨¡å‹ï¼</div>`;
                     chatLog.scrollTop = chatLog.scrollHeight;
                     chatHistory.pop(); // å›é€€è¿™å›åˆ
                     return; 
                }

                chatHistory.push({ role: "assistant", content: reply });
                
                // ã€è§£é™¤é™é»˜æ­»é”ã€‘ç›´æ¥æŠŠæ–‡æœ¬å–‚ç»™æ‰“å­—æœºï¼Œç»ä¸æ‹¦æˆªï¼
                await parseReplyAndAddReport(reply);

            } catch (error) {
                document.getElementById(loadingId)?.remove();
                setConnectionStatus(`ğŸ”´ è¿æ¥æ–­è£‚`, "#ff0000");
                if (error.name !== 'AbortError') {
                    chatLog.innerHTML += `<div class="msg system" style="color:#ff0000; font-weight:bold;">å¤©é“å´©å¡Œï¼š${error.message}</div>`;
                    chatLog.scrollTop = chatLog.scrollHeight;
                }
            } finally {
                // ã€ç»ˆæå…œåº•ã€‘æ— è®ºæ‰“å­—ç»“æŸè¿˜æ˜¯æŠ¥é”™ï¼Œå¿…å®šé‡ç½®æŒ‰é’®çŠ¶æ€ï¼
                document.getElementById('send-btn').disabled = false; 
                document.getElementById('stop-btn').classList.remove('active');
            }
        }

        async function parseReplyAndAddReport(rawReply) {
            const chatLog = document.getElementById('chat-log');
            
            let cleanReply = rawReply;
            let reportDataStr = null;

            // å¼ºè¡ŒæŒ–å‡º ===REPORT=== åçš„å†…å®¹ï¼Œæˆ–è€…ç›´æ¥æ‰¾ JSON å¤§æ‹¬å·ï¼
            let reportMatch = rawReply.match(/===.*?REPORT.*?===([\s\S]*)/i);
            
            if (reportMatch && reportMatch[1]) {
                cleanReply = rawReply.substring(0, reportMatch.index).trim();
                reportDataStr = reportMatch[1].trim();
            } else {
                let jsonMatch = rawReply.match(/\{[\s\S]*"hp"[\s\S]*\}/i);
                if (jsonMatch) {
                    reportDataStr = jsonMatch[0];
                    cleanReply = rawReply.replace(reportDataStr, '').trim();
                }
            }
            
            let yaoMsgDiv = document.createElement('div');
            yaoMsgDiv.className = 'msg yao';
            yaoMsgDiv.innerHTML = 'ã€åŒ–èº«å¤§å¦–ã€‘: <span class="typing-content"></span>';
            chatLog.appendChild(yaoMsgDiv);
            
            let textSpan = yaoMsgDiv.querySelector('.typing-content');
            
            // ç­‰å¾…æ‰“å­—æœºæ‰“å®Œ
            await typeWriterEffect(textSpan, cleanReply, 20);

            // âš ï¸ã€è‡´å‘½BUGå·²åœ¨æ­¤å¤„è¢«æ‹”é™¤ï¼Œä¸å†æœ‰ä»»ä½• return é˜»æŒ¡ç»“ç®—ï¼ã€‘âš ï¸

            // å¼€å§‹ç»“ç®—è¡€æ¡
            if (reportDataStr) {
                try {
                    // å½»åº•æ¸…æ´—æ®‹ä½™ï¼Œç²¾å‡†æå– JSON å¯¹è±¡
                    let jsonStr = reportDataStr.replace(/```json/gi, '').replace(/```/g, '').trim();
                    let exactJsonMatch = jsonStr.match(/\{[\s\S]*\}/);
                    if (exactJsonMatch) {
                        jsonStr = exactJsonMatch[0];
                    }
                    
                    const reportData = JSON.parse(jsonStr);
                    
                    const hpChange = parseInt(reportData.hp) || 0;
                    const intentChange = parseInt(reportData.intent) || 0;
                    const reason = reportData.reason || "è§¦çŠ¯å½’å¢Ÿæ³•åˆ™";

                    // æ‰§è¡Œæ‰£è¡€ (ä¿è¯è¡€é‡ä¸ä½äº0)
                    playerHp = Math.max(0, playerHp - Math.abs(hpChange)); 
                    demonIntent = Math.max(0, demonIntent - Math.abs(intentChange));
                    updateHpBars(); // ç«‹å³æ›´æ–° UI è¿›åº¦æ¡

                    // æ›´æ–°ç›‘æ§å™¨ç­–ç•¥æç¤º
                    if (reportData.strategy) {
                        const strategyEl = document.getElementById('current-strategy');
                        strategyEl.innerText = reportData.strategy + ` (ç¬¬${currentRound}å›åˆ)`;
                        strategyEl.style.color = "#ff3333"; 
                        strategyEl.style.textShadow = "0 0 10px #ff0000";
                        setTimeout(() => { 
                            strategyEl.style.color = "#ccc"; 
                            strategyEl.style.textShadow = "none"; 
                        }, 2000);
                    }

                    // æ‰“å°å®ªæ³•æŠ¥å‘Šè€³å…‰
                    chatLog.innerHTML += `
                        <div class="msg report">
                            <span class="rep-label">[å®ªæ³•æŠ¥å‘Š]</span> å› ä¸ºï¼š${reason} <br>
                            <span style="display:inline-block; margin-top:5px; color:#fff;">
                                å‘½ç›˜è¢«æ’•è£‚ <span style="color:var(--accent-red); font-weight:bold; font-size:1.1rem;">-${Math.abs(hpChange)}%</span> 
                                ï½œ å¤§å¦–æ€æ„ <span style="color:#aaa;">-${Math.abs(intentChange)}%</span>
                            </span>
                        </div>`;
                    chatLog.scrollTop = chatLog.scrollHeight;

                    // æ­»äº¡æˆ–èƒœåˆ©åˆ¤å®š
                    if (playerHp === 0) endBattle("lose");
                    else if (demonIntent === 0) endBattle("win");
                    
                } catch (e) {
                    console.error("è§£æåŠ«æ•°æ•°æ®åŒ…å¤±è´¥ï¼š", e, "åŸå§‹å­—ç¬¦ä¸²ï¼š", reportDataStr);
                }
            }
        }

        function endBattle(type = "lose") {
            document.getElementById('input-area').style.display = 'none';
            const chatLog = document.getElementById('chat-log');
            if (type === "lose") {
                chatLog.innerHTML += `<div class="msg system" style="text-align:center; border: 2px solid var(--accent-red); padding: 30px 10px; margin-top: 30px; background: rgba(139,0,0,0.1); border-radius: 8px;"><h1 style="color: var(--accent-red); font-size: 3rem; text-shadow: 0 0 25px #ff0000; margin-bottom: 10px; letter-spacing: 10px;">é“å¿ƒç ´ç¢</h1><p style="color: #fff; font-size: 1rem;">æ±ä¹‹å‘½ç›˜å·²ç¢ã€‚ç°å®é‡Œä¸ä¼šç»™ä½ é‡æ¥çš„æœºä¼šã€‚</p><button onclick="location.reload()" style="background: var(--accent-red); color: #fff; border: 2px solid #fff; padding: 15px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; margin-top: 15px;">å†æˆ˜å¤§å¦–</button></div>`;
            } else {
                chatLog.innerHTML += `<div class="msg system" style="border: 2px solid #fff; padding: 20px; margin-top: 30px;"><h3 style="color: #fff; margin-top: 0;">=============== æ€æ„å½’é›¶ï¼Œå¤§å¦–ç¦»åœº ===============</h3></div>`;
            }
            chatLog.scrollTop = chatLog.scrollHeight;
        }
    </script>
</body>
</html>